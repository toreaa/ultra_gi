# Story 7.4: Smarte anbefalinger

## Status
**Draft**

## Story
**As a** user, **I want** to get smart recommendations based on my data, **so that** I can optimize my nutrition strategy.

## Acceptance Criteria
1. Anbefalinger vises på Analyse-skjerm
2. Algoritme identifiserer: Beste produkter (oftest uten ubehag), Problematiske produkter, Optimal rate, Timing-mønstre
3. Anbefalinger vises som kort: Ikon, Tittel, Forklaring
4. "Lær mer"-knapp → Detaljert forklaring
5. Anbefalinger oppdateres dynamisk
6. Minimum data-krav: 5+ fullførte økter

## Tasks / Subtasks
- [ ] Create `src/services/recommendations.ts`
- [ ] Implement `generateRecommendations(sessions): Recommendation[]`
- [ ] Analyze product success rate (økter uten ubehag / total økter med produkt)
- [ ] Analyze carb rate vs discomfort (group by rate buckets)
- [ ] Analyze discomfort timing patterns (histogram)
- [ ] Create `src/components/analysis/RecommendationCard.tsx`
- [ ] Display recommendations on AnalysisScreen
- [ ] Test with 5+ sessions

## Dev Notes
**Algorithm [Source: architecture/prd/epic-7-analysis.md#recommendation-algorithm]:**
```typescript
export function generateRecommendations(sessions: SessionLog[]): Recommendation[] {
  if (sessions.length < 5) return [{type: 'info', title: 'Fullfør 5+ økter', message: '...'}];

  const recommendations = [];

  // 1. Product analysis
  const productStats = new Map();
  sessions.forEach(session => {
    const intakes = session.events.filter(e => e.event_type === 'intake');
    const hasDiscomfort = session.events.some(e => e.event_type === 'discomfort');

    intakes.forEach(intake => {
      const data = JSON.parse(intake.data_json);
      const productId = data.fuel_product_id;
      if (!productStats.has(productId)) {
        productStats.set(productId, {name: data.product_name, successCount: 0, totalCount: 0});
      }
      const stats = productStats.get(productId);
      stats.totalCount++;
      if (!hasDiscomfort) stats.successCount++;
    });
  });

  productStats.forEach((stats, productId) => {
    if (stats.totalCount >= 3) {
      const successRate = stats.successCount / stats.totalCount;
      if (successRate > 0.8) {
        recommendations.push({
          type: 'product_success',
          title: `✅ ${stats.name} fungerer bra`,
          message: `${stats.successCount} av ${stats.totalCount} økter uten ubehag`
        });
      }
    }
  });

  // 2. Optimal rate analysis
  // ...

  return recommendations;
}
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story | Bob (SM) |

## Dev Agent Record
*To be filled*

## QA Results
*To be filled*
