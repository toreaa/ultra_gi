# Story 7.3: Identifiser mønstre

## Status
**Draft**

## Story
**As a** user, **I want** to see an overview of all my sessions with statistics, **so that** I can identify patterns.

## Acceptance Criteria
1. "Analyse"-skjerm tilgjengelig fra hovednavigasjon
2. Oversikt over alle fullførte økter (tabell): Dato, Varighet, Karb-rate, Antall ubehag, Gj.snitt ubehag, Status-ikon
3. Sorterbare kolonner (dato, karb-rate, ubehag)
4. Filter: Program (dropdown), Dato-range, Karb-rate
5. Aggregert statistikk øverst: Total økter, Gj.snitt karb-rate, Økter uten ubehag (%), Økter med alvorlig ubehag
6. Trykk på økt → Gå til Story 7.1

## Tasks / Subtasks
- [ ] Create `src/screens/analysis/AnalysisScreen.tsx`
- [ ] Create `src/components/analysis/SessionTable.tsx`
- [ ] Query all completed sessions with aggregated stats
- [ ] Implement sortable columns (FlatList with sort state)
- [ ] Add filter controls (program selector, date range picker)
- [ ] Calculate aggregate statistics
- [ ] Test with 10+ completed sessions

## Dev Notes
**Aggregation Query:**
```sql
SELECT
  sl.id, sl.started_at, sl.duration_actual_minutes,
  (SUM(CASE WHEN se.event_type = 'intake' THEN JSON_EXTRACT(se.data_json, '$.carbs_consumed') ELSE 0 END) / sl.duration_actual_minutes) * 60 AS carb_rate_per_hour,
  COUNT(CASE WHEN se.event_type = 'discomfort' THEN 1 END) AS discomfort_count,
  AVG(CASE WHEN se.event_type = 'discomfort' THEN JSON_EXTRACT(se.data_json, '$.level') END) AS avg_discomfort
FROM session_logs sl
LEFT JOIN session_events se ON se.session_log_id = sl.id
WHERE sl.session_status = 'completed'
GROUP BY sl.id
ORDER BY sl.started_at DESC;
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story | Bob (SM) |

## Dev Agent Record
*To be filled*

## QA Results
*To be filled*
