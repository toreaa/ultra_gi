# Story 4.3: Bekreft plan

## Status
**Draft**

## Story
**As a** user, **I want** to confirm my nutrition plan, **so that** the app is ready for session mode.

## Acceptance Criteria
1. "Bekreft plan"-knapp nederst på planleggingsskjerm
2. Ved bekreftelse: Plan lagres i planned_sessions table, fuel_plan_json inneholder produkter + timing, planned_date settes
3. Toast: "✓ Plan lagret!"
4. Navigering: Tilbake til program-detaljer (økt markert som "⏳ Planlagt") ELLER direkte til "Økt-modus" (Epic 5) med prompt "Vil du starte økten nå?"
5. Planlagt økt vises på dashboard med "Start økt" knapp

## Tasks / Subtasks
- [ ] Create `src/database/repositories/PlannedSessionRepository.ts`
- [ ] Implement `create(userId, programSessionId, fuelPlan, notes)`
- [ ] Insert into planned_sessions table with fuel_plan_json
- [ ] Show confirmation toast
- [ ] Show prompt: "Vil du starte økten nå?" with Yes/No buttons
- [ ] If Yes → Navigate to Epic 5 (ActiveSessionScreen)
- [ ] If No → Navigate back to ProgramDetailScreen
- [ ] Update DashboardScreen to show planned session

## Dev Notes
**Database [Source: architecture/database-schema.md]:**
```sql
CREATE TABLE planned_sessions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL DEFAULT 1,
  program_session_id INTEGER,
  planned_date TEXT NOT NULL,
  fuel_plan_json TEXT NOT NULL,
  notes TEXT,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (program_session_id) REFERENCES program_sessions(id)
);
```

**fuel_plan_json format:**
```json
[
  {
    "fuel_product_id": 1,
    "product_name": "Maurten Gel 100",
    "quantity": 2,
    "timing_minutes": [25, 50],
    "carbs_total": 50
  }
]
```

**Repository:**
```typescript
export class PlannedSessionRepository {
  static async create(data: {
    user_id: number;
    program_session_id?: number;
    planned_date: string;
    fuel_plan_json: string;
    notes?: string;
  }): Promise<number> {
    const db = await getDatabase();
    const result = await db.runAsync(
      'INSERT INTO planned_sessions (user_id, program_session_id, planned_date, fuel_plan_json, notes) VALUES (?, ?, ?, ?, ?)',
      [data.user_id, data.program_session_id || null, data.planned_date, data.fuel_plan_json, data.notes || null]
    );
    return result.lastInsertRowId;
  }
}
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story | Bob (SM) |

## Dev Agent Record
*To be filled*

## QA Results
*To be filled*
