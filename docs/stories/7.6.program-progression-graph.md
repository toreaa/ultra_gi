# Story 7.6: Progresjonsgraf per program (NEW)

## Status
**Draft**

## Story
**As a** user, **I want** to see a progression graph for my active program, **so that** I can see how my tolerance develops over time.

## Acceptance Criteria
1. Program-detaljskjerm (Epic 3.3) har "Se progresjon"-knapp
2. Trykk → Åpne progresjonsgraf-skjerm
3. Graf viser (Victory Native): X-akse (økt-nummer 1-8), Y-akse primær (karb-rate g/time), Y-akse sekundær (ubehag nivå)
4. Data-serier: Planlagt karb-rate (stiplet, grå), Faktisk karb-rate (solid, blå), Ubehag (røde punkter)
5. Kun fullførte økter vises
6. Tooltip ved trykk: "Uke 2, Økt 1: 48g/t (mål: 45g/t), Ubehag: 2/5"
7. Hvis < 2 fullførte: Vis placeholder "Fullfør minst 2 økter"

## Tasks / Subtasks
- [ ] Create `src/screens/programs/ProgramProgressionScreen.tsx`
- [ ] Create `src/components/analysis/ProgressionChart.tsx`
- [ ] Query program progression data (ProgramRepository.getProgressionData)
- [ ] Transform data for Victory Native chart
- [ ] Implement VictoryChart with multiple data series
- [ ] Add tooltip on data point press
- [ ] Handle empty state (< 2 sessions)
- [ ] Test with partially completed program

## Dev Notes
**Progression Query:**
```sql
SELECT
  ps.session_number,
  ps.carb_rate_g_per_hour AS planned_rate,
  (SUM(CASE WHEN se.event_type = 'intake' THEN JSON_EXTRACT(se.data_json, '$.carbs_consumed') ELSE 0 END) / sl.duration_actual_minutes) * 60 AS actual_rate,
  AVG(CASE WHEN se.event_type = 'discomfort' THEN JSON_EXTRACT(se.data_json, '$.level') END) AS avg_discomfort
FROM program_sessions ps
LEFT JOIN planned_sessions pls ON pls.program_session_id = ps.id
LEFT JOIN session_logs sl ON sl.planned_session_id = pls.id AND sl.session_status = 'completed'
LEFT JOIN session_events se ON se.session_log_id = sl.id
WHERE ps.program_id = ?
GROUP BY ps.session_number
ORDER BY ps.session_number;
```

**Chart:**
```typescript
<VictoryChart>
  <VictoryLine data={plannedRateData} style={{data: {stroke: '#888', strokeDasharray: '4,4'}}} />
  <VictoryLine data={actualRateData} style={{data: {stroke: '#2196F3', strokeWidth: 2}}} />
  <VictoryScatter data={discomfortData} size={(d) => d.y * 2} style={{data: {fill: '#D32F2F'}}} />
</VictoryChart>
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | NEW story based on user feedback | Bob (SM) |

## Dev Agent Record
*To be filled*

## QA Results
*To be filled*
