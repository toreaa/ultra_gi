# Story 5.2: Varsler for inntak

## Status
**Draft**

## Story
**As a** user in session mode, **I want** to get notifications when it's time for planned intake, **so that** I don't forget to fuel at the right time.

## Acceptance Criteria
1. Notifikasjoner scheduleres basert på fuel plan (Epic 4)
2. Eksempel (fuel plan: 0:25, 0:50, 1:00): Etter 25 min → "⏰ Tid for inntak: Maurten Gel"
3. Notifikasjon inneholder: Tittel "Tid for inntak", Melding "[Produktnavn] ([Xg] karbs)", Lyd + Vibrasjon
4. Trykk på notifikasjon → Åpne app (aktiv økt-skjerm)
5. Notifikasjoner fortsetter selv om app er i bakgrunnen
6. Hvis spontan økt (ingen plan): Ingen notifikasjoner

## Tasks / Subtasks
- [ ] Create `src/services/notificationService.ts`
- [ ] Implement `scheduleIntakeReminder(timingMinutes, productName, carbs)`
- [ ] Use expo-notifications API
- [ ] Request NOTIFICATIONS permission on first session start
- [ ] Schedule notifications based on fuel_plan_json from planned_session
- [ ] Cancel all notifications when session ends
- [ ] Handle notification tap → deep link to ActiveSessionScreen
- [ ] Test notifications work when app backgrounded

## Dev Notes
**Implementation [Source: architecture/tech-stack.md#real-time-features]:**
```typescript
// src/services/notificationService.ts
import * as Notifications from 'expo-notifications';

export async function scheduleIntakeReminder(
  timingMinutes: number,
  productName: string,
  carbs: number
): Promise<string> {
  const trigger = { seconds: timingMinutes * 60 };

  const notificationId = await Notifications.scheduleNotificationAsync({
    content: {
      title: '⏰ Tid for inntak',
      body: `${productName} (${carbs}g karbs)`,
      sound: true,
      vibrate: [0, 250, 250, 250],
    },
    trigger,
  });

  return notificationId;
}

export async function cancelAllReminders(): Promise<void> {
  await Notifications.cancelAllScheduledNotificationsAsync();
}
```

**Permission Request:**
```typescript
const { status } = await Notifications.requestPermissionsAsync();
if (status !== 'granted') {
  Alert.alert('Notifications disabled', 'Enable to get intake reminders');
}
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story | Bob (SM) |

## Dev Agent Record
*To be filled*

## QA Results
*To be filled*
