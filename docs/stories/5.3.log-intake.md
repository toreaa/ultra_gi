# Story 5.3: Logg inntak

## Status
**Draft**

## Story
**As a** user in session mode, **I want** to have one large button to confirm planned intake, **so that** I log the timestamp with one tap.

## Acceptance Criteria
1. Aktiv økt-skjerm viser: Timer (øverst), Neste planlagte inntak (if plan), **Stor "INNTAK"-knapp** (sentral, grønn)
2. Trykk på "INNTAK"-knapp: Hvis planlagt → Quick-log automatisk + toast, Hvis ingen plan → Vis quick-select liste, Event lagres i session_events
3. Event lagres: event_type='intake', timestamp_offset_seconds, data_json: {fuel_product_id, product_name, quantity, carbs_consumed, was_planned}
4. Liste over loggede events vises nederst (scrollable): "00:25 - ✓ Maurten Gel (25g)"

## Tasks / Subtasks
- [ ] Create `src/components/session/IntakeButton.tsx` (large green button)
- [ ] Create `src/components/session/SessionEventList.tsx` (scrollable event log)
- [ ] Implement `sessionManager.logIntake(fuelProductId, quantity)`
- [ ] INSERT INTO session_events with event_type='intake'
- [ ] Calculate timestamp_offset_seconds from session start
- [ ] Store data_json with fuel product details
- [ ] Show toast after logging
- [ ] Update "Neste planlagte inntak" display
- [ ] Handle quick-select for unplanned intakes

## Dev Notes
**Database:**
```sql
CREATE TABLE session_events (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  session_log_id INTEGER NOT NULL,
  event_type TEXT NOT NULL,  -- 'intake' | 'discomfort' | 'note'
  timestamp_offset_seconds INTEGER NOT NULL,
  actual_timestamp TEXT NOT NULL,
  data_json TEXT NOT NULL,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY (session_log_id) REFERENCES session_logs(id)
);
```

**data_json format:**
```json
{
  "fuel_product_id": 1,
  "product_name": "Maurten Gel 100",
  "quantity": 1,
  "carbs_consumed": 25,
  "was_planned": true
}
```

**Component:**
```typescript
<IntakeButton onPress={handleLogIntake} />

// If planned intake exists
const handleLogIntake = async () => {
  const nextIntake = getNextPlannedIntake();
  await sessionManager.logIntake(nextIntake.fuel_product_id, nextIntake.quantity);
};

// If no plan
const handleLogIntake = async () => {
  const products = await FuelProductRepository.getAll(userId);
  showQuickSelect(products, async (selectedProductId) => {
    await sessionManager.logIntake(selectedProductId, 1);
  });
};
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story | Bob (SM) |

## Dev Agent Record
*To be filled*

## QA Results
*To be filled*
